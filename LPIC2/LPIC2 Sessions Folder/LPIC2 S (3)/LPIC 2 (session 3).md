---
tags:
  - LPIC
  - linux
  - command
  - concept
up: "[[LPIC2 Sessions map of content]]"
date: 1402-07-23 2023-10-15
---
با این دستور میتوانیم اطلاعات مختلفی از اتصالمان به اینترنت مثل آی پی پابلیک بدست بیاوریم.
```bash
curl -s ip-api.com
```

> [!question] چرا A رکورد یک دامنه در صورتی که DNS آن یک ساب دومین از دومین اصلی باشد، هم در سرور زون والد و هم در خود خود سرور ثبت می شود؟
> به این دلیل که هیچ سرور دیگری نمی تواند آدرس ip ساب دومین مربوطه را داشته باشد بنابراین DNS والد باید این آدرس را برای لوکاپ شدن توسط دیگر سرورها داشته باشد.
> و خود ساب دامنه اگر از داخل شبکه یا جای دیگری کوئری دریافت کند باید ip اصلی hostname خودش را داشته باشد. بنابراین این A رکورد در هر دوجا ثبت می شود.

### فرآیند Zone Transfer
اگر بیش از یک DNS داشته باشیم، بهتر است که با تغییر یک سرور، سرورهای دیگر هم تغییر کنند.
برای این کار ما زون ها را مستر یا اسلیو تعریف میکنیم و اطلاعات سرور از مستر به اسلیو transfer می شود.
این انتقال به ازای zone ها اتفاق می افتد، (نه به ازای سرور) یعنی اگر روی یک سرور چندین zone باشد باید به ازای هر zone یک انتقال صورت بگیرد.

> [!question] چرا لازم است بیش از یک DNS سرور داشته باشیم؟
> چرا که آدرس ip همه سرویس های ما از DNS پرسیده می شود و اگر DNS به هر دلیلی از مدار خارج شود در واقع تمامی سرویس های ما از دسترس خارج می شوند.
> و برای اینکه احتمال وقوع این مشکل کم شود ما نیاز داریم که چند DNS سرور با اینترنت های مختلف و در مکان های مختلف داشته باشیم.
#### تنظیمات سرور Master , Slave
برای تنظیمات فایل named.conf ملاحظه شود.
![[named.conf#Slave]]

> [!idea] زمان هایی که در SOA رکورد فایل [[named.conf]] وجود دارند (Refresh, Retry, Expire) برای مواردی است که سرور را به حال خود رها می کنیم و به این صورت سرور طبق این زمان ها خود را بروزرسانی میکنند. اما به محض اینکه یکی از سرورها را ریستارت کنیم و سریال را افزایش دهیم، عملیات zone transfer اتفاق می‌افتد.

> [!question] اگر ns مستر از کار بیفتد و تایم اکسپایر تمام شود چه اتفاقی می افتد؟

#### امنیت Zone Transfer
امنیت در zone transfer خیلی مهم است چرا که بدون امنیت، یک هکر میتواند خود را جای master جا بزند و Aرکوردهای جدیدی تعریف کند و در این صورت سایت دیگری را به جای وب سایت ما جایگزین کند.
سه روش برای ایجاد امنیت بین DNS ها وجود دارد اما **بهتر است برای امنیت هرچه بیشتر هر سه مرحله را انجام داد.**
1. استفاده از یک شبکه اختصاصی یا local interface به جای اینترنت که منجر به استفاده از invalid ip می‌شود. مثلا استفاده از mpls مخابرات (اما اتکر از داخل مخابرات میتواند اتک کند)
- برای این کار invalid ip خود را باید در also notify و allow-transfer تنظیمات قرار دهیم
2. استفاده از tunnel VPN برای ترافیک سرور ها یا حداقل ترافیک DNS ها
-  برای این کار میتوان از هر روش دلخواهی استفاده کرد.
3. استفاده از مکانیزم رمزنگاری bind که TSIG نام دارد و میتوان برای مستر و اسلیو یک key تعریف کرد

> [!question] در فایل named.conf.default-zones اطلاعات مختلفی است . این فایل کارش چیه؟
> // prime the server with knowledge of the root servers
zone "." {
        type hint;
        file "/usr/share/dns/root.hints";
	};
	// be authoritative for the localhost forward and reverse zones, and for
	// broadcast zones as per RFC 1912
	zone "localhost" {
	        type master;
	        file "/etc/bind/db.local";
	};
	zone "127.in-addr.arpa" {
	        type master;
	        file "/etc/bind/db.127";
	};
	zone "0.in-addr.arpa" {
	        type master;
	        file "/etc/bind/db.0";
	};
	zone "255.in-addr.arpa" {
	        type master;
	        file "/etc/bind/db.255";
	};
	> 	Contents

##### TSIG
- با دستور [[TSIG]] یک کلید جنریت می کنیم.
- کلید ایجاد شده را میتوانیم در فایل [[named.conf]] ذخیره کنیم یا اینکه در فایلی مجزا ذخیره کنیم و آدرس آن را اینکلود کنیم در فایل named.conf
- تنظیمات مربوطه به سرور مستر را در فایل named.conf.local انجام میدهیم
- تنظیمات مربوط به سرور اسلیو را در فایل named.conf.options انجام میدهیم
![[named.conf#TSIG key configuration]]

#### Kubernetes
- کوبرنتیز ابزاری است برای لودبالانسینگ سرورها ، به خصوص زمانی که داریم از کانتینر ها استفاده میکنیم.
- الگورتیم ها میختلف پابلیک و پرایویت برای لود بالانسینگ وجود دارند.
- از دیگر امکانات اورکستریشن این است که اگر درخواست های ما افزایش پیدا کنند خود این ابزار ها میتوانند پاد اضافه کنند به مجموعه سرورهای ما
- قبل از یادگیری کوبرنتیز باید کانتینرها مثل داکر رو یاد بگیریم. در کانتینرها یاد میگیریم که چگونه یک سرویس را کانتینرایز کنیم
#### microservices
در اپلیکیشن های بزرگ به ازای هر بخش از برنامه یک سرویس مجزا تعریف می شود. مثلا برای لاگین یا برای بکاپ یک سرویس مجزا طراحی می شود و این سرویها چه با هم و چه بدون هم کارکرد دارند.
