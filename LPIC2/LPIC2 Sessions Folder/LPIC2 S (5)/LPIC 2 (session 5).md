---
tags:
  - LPIC
  - linux
  - webservice
  - Apache
up: "[[LPIC2 Sessions map of content]]"
date: 2023-11-04
---
### Redirect
امکان ریدایرکت کردن در تنظیمات ویرچوال هاست وجود دارد و کاربردهای بسیاری دارد.
استتوس کد 302 به معنای ریدایرکت موقت است. در چنین ریسپانسهایی دایرکتیوی به نام location وجود دارد که مقدار آن یک URL است و کلاینت پس از دریافت این استتوس کد یک رکوئست دیگر به آن URL ارسال می کند.
مثال
```bash
Redirect 302 /google "google.com"
```
در این مثال اگر google در انتهای آدرس وارد شود کلاینت به وب سایت google.com ریدایرکت می شود.
در صورتی که از کد 301 استفاده کنیم، ریدایرکت دائمی اتفاق می افتد.
مثال
```bash
Redirect 301 /google "google.com"
```
اگر هیچ کدی در دستور ریدارکت قرار ندهیم 302 به عنوان پیش فرض انتخاب می‌شود.
> [!search] در صورت نیاز، make redirect in apache server جستجو شود.
> 

> [!idea] اکثر دایرکتیوهای Apache یک ورژن دیگری به نام match دارند که برای استفاده از Regex ازین نوع دایرکتیوها استفاده می شود.
#### RedirectMatch
برای ریدایرکت کردن در صورت مچ شدن یک رجکس خاص ازین دستور استفاده میکنیم.
مثال
```bash
RedirectMatch '/.+\.html' "https://google.com"
```
در این مثال هر رکوئستی که به .html ختم شود به گوگل ریدایرکت می شود حتی اگر آن آدرس در سرور تعریف نشده باشد.

در صورتی که تعداد زیادی از آدرس ها ما تغییر کرده باشد میتوانیم از RedirectMatch و قابلیت grouping regex استفاده کنیم.
```bash
RedirectMatch '/(.+)\.html' "http://mywebsite.com/$1.htm"
```
در مثال بالا ما هر رکوئستی که به آدرسهای html ختم می شود را ریدایرکت کردیم به همان آدرسها با پسوند htm

> [!idea] آدرس URL ریدایرکت را حتما باید کامل بنویسیم. 

#### Files
این دایرکتیو یک کانتینر است و به شکل زیر نوشته می شود. 
![[Pasted image 20231104102524.png]]
با این دایرکتیو تمامی رکوئست ها برای فایل مربوطه ریسپانس 403 Forbidden میگیرند.
> [!search] در صورت نیاز، Files directive example in apache سرچ شود. چرا که امکانات گسترده ای برای مدیریت فایل ها روی Apache داریم.

#### FilesMatch
ورژن Match فایل است
![[Pasted image 20231104103129.png]]
در این مثال تمامی رکوئست هایی که به فایل های txt بیاید ریسپانس 403 میگیرند.

> [!idea] تمامی داکیومنت های Apache در [این](https://httpd.apache.org/) آدرس وجود دارد. 

> [!question] در صورتی که ما ادمین سرور باشیم، چطور میتوانیم به ادمین های وب سایتهایی که روی سرور ما قرار دارند امکان کانفیگ کردن فایل کانفیگوریشن ویرچوال هاست را در زیر شاخه siets-available داریم؟
> استفاده از distributed configuration file

#### مفهوم distributed configuration file
1. در این روش ادمین سرور باید دایرکتیوی به نام AllowOverride را در فایل کانفیگ ویرچوال هاست مربوطه داخل کانتینر Directory قرار بدهد طبق عکس:
![[Pasted image 20231104111354.png]]
- دایرکتیو AllowOverride میتواند مقادیر دیگری مثل none هم داشته باشد.
2. ادمین وب سایت مربوطه مثلا gilan اگر در هر دایرکتوری زیر شاخه این ویرچوال هاست فایلی به نام .htaccess ایجاد کند و داخل آن کانفیگهای مورد نیاز خودش را قرار دهد، آن دایرکتوری که این فایل در آن قرار دارد متاثر از کانفیگهای .htaccess خواهد بود. به این ترتیب تنظیمات مورد نیاز ادمین هر وب سایت بدون دخالت ادمین سرور در سرور قرار میگیرد.
> [!idea] نام فایل .htaccsess در کانفیگ اصلی سرور apache قابل تغییر است.

> [!question] چرا از فرآند include به جای AllowOverride استفاده نمی کنیم؟
> - چون اگر با استفاده از include تنظیمات ادمین سایت را وارد کانفیگ اصلی سرور کنیم، ادمین سایت نیاز دارد بعد از هر تغییر نیاز به ریستارت یا ریلود سرور دارد.
> - مشکل دیگر این است که با استفاده از include ادمین سایت میتواند هر کانفیگ درست یا غلطی را وارد کانفیگ اصلی سرور کند اما از طریق .htaccess نمیتواند هر تنظیمی را وارد کند و نیازی به ریستارت یا ریلود هم نیست.

> [!idea] این که فایل .htaccess اصلا خوانده شود یا نشود را دایرکتیو AllowOverride تعیین میکند. و این دایرکتیو را per Directory می نویسیم

> [!search] در صورت نیاز، htaccess configuration سرچ شود. 
### HTTP Authentication 
یکی از امکانات پروتکل HTTP این است که دسترسی به یک سری از ریسورسهامون رو با توجه به URL اونها نیازمند احرازهویت کنیم.
این تنظیم با دایرکتیو AuthType اعمال می شود و هم در فایل کانفیگ ویرچوال هاست قرار میگیرد و هم در فایل .htaccess
در حال حاضر ما برای دایرکتیو AuthType از مقدار  Basic استفاده میکنیم. مقادیر دیگری هم وجود دارد که از رده خارج شده چرا که وب سایت ها به طور کلی از امنیت SSL استفاده می کنند.
![[Pasted image 20231104114639.png]]
![[Pasted image 20231104114511.png]]
برای ایجاد فایل یوزرپسورد کاربران از دستور htpasswd استفاده میکنیم.
این دستور علاوه بر ایجاد فایل، پسورد ها را رمزنگاری میکند.
```bash
htpasswd -c .htfilename ali
```
در مثال بالا فایلی به نام .htfilename ایجاد شد و اولین یوزر به نام ali در آن ذخیره شد.
```bash
htpasswd .htfilename mina
```
و در این مثال یوزر مینا اضافه شد.
فایل پسورد را با .ht شروع میکنیم که طبق تنظیمات apache دسترسی به آن محدود می شود.
![[Pasted image 20231104120405.png]]

> [!search] در صورت نیاز، http authentication configuration سرچ شود.

> [!search] در صورت کنجکاوی، curl basic authentication جستجو شود 
> 


> [!question] رکوئست ها چطور پسورد ها را ارسال میکنند. با توجه به اینکه شاید داخل پسورد کارکترهای خاص وجود داشته باشد که برای سرور معانی مختلفی داشته باشد؟
> جواب : یوزر پسورد ها با الگوریتمی مثل base64 انکد می شوند
> این الگوریتم ها هر فایل باینری مثل متن عکس صدا را به متن تبدیل می کنند.
> این الگوریتم ها ارتباطی به امنیت ندارند و صرفا تغییر ماهیت فایلهاست.

### HTTPS
موضوع امنیت فقط محدود به دنیای وب نیست و تقریبا همه چیز در دنیای امروز باید secure شوند.

#### **توضیحاتی در مورد Cryptography**
![[Pasted image 20231104140408.png]]
![[Recording 20231104140335.webm]]
![[Pasted image 20231104140436.png]]

#### اتک man in the middle

![[Recording 20231104140756.webm]]
![[Pasted image 20231104140738.png]]
![[Pasted image 20231104141128.png]]
##### فرآیند اعتبار سنجی SSH

![[Pasted image 20231104141557.png]]

![[Recording 20231104142115.webm]]

![[Pasted image 20231104141817.png]]

##### فرآیند اعتبار سنجی CA

![[Recording 20231104142536.webm]]
![[Recording 20231104144428.webm]]
![[Pasted image 20231104144241.png]]
##### CA اختصاصی و تفاوت آن با CA عمومی

![[Recording 20231104144905.webm]]

##### راه های امن کردن ارتباطات با CA
1. **Local CA** 
![[Recording 20231104150410.webm]]
2.  **Self Signed Certificate** 
![[Recording 20231104153003.webm]]
3.  Valid Ca lets encrypt 
![[Recording 20231104153026.webm]]

![[Recording 20231104153550.webm]]
